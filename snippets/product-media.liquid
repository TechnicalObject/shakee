{% comment %}
  Renders product media in various different layouts, depending on the settings in the section.

  Accepts:
    - id: {String} The instance id (required)
    - section_id: The section ID (optional)
    - type: {String} The type of media layout eg. slider, thumbnails (required)
    - product: {Object} The product object (required)
    - section: {Object} The section object (required)
    - device: {String} The device type eg. desktop, mobile (required)
    - has_pagination: {Boolean} Whether to show pagination (optional)
    - enable_peep: {Boolean} Whether to enable peep (optional)
    - is_quick_view: {Boolean} Whether the media is being rendered in quick view (optional)
    - hide_out_of_stock_variants: {Boolean} Whether to hide out of stock variants (optional)
    - change_variant_based_on_thumbnail: {Boolean} Whether to change the variant based on the thumbnail (optional)
    - onboarding: {Boolean} Whether to render an onboarding product media when product media size is 0 (eg. Featured Product) (optional)
  
  Usage:
    {% render product_media with id: 'product-media', product: product, section: section, device: 'mobile', has_pagination: true, enable_peep: true %}
{% endcomment %}

{{ 'component-product-media.min.css' | asset_url | stylesheet_tag }}

{% style %}
  {% if device == 'mobile' %}
    @media (max-width: 767px) {
      #{{ id }} {
        visibility: visible;
        height: unset;
      }
    }

    @media (min-width: 768px) {
      #{{ id }} {
        visibility: hidden;
        height: 0;
      }

      #{{ id }} deferred-media {
        display: none;
      }
    }
  {% elsif device == 'desktop' %}
    @media (max-width: 767px) {
      #{{ id }} {
        visibility: hidden;
        height: 0;
      }

      #{{ id }} deferred-media {
        display: none;
      }
    }

    @media (min-width: 768px) {
      #{{ id }} {
        visibility: visible;
        height: unset;
      }
    }
  {% endif %}
  [data-product-badge] {
    display: flex;
    flex-wrap: wrap;
    gap: 0.3rem;
    position: absolute;
    top: 1rem;
    left: 1rem;
    z-index: 2;
    scale: 1.3;
    margin-left: 30px;
    margin-top: 5px;
  }

  .badge {
    flex-shrink: 0;
  }
{% endstyle %}

{% liquid 
  assign image_crop = section.settings.image_shape

  unless section_id
    assign section_id = section.id
  endunless

  assign thumbnail_position = section.settings.thumbnail_position
  if device == 'mobile'
    assign thumbnail_position = 'below'
  endif

  assign custom_aspect_ratio = false
  if image_crop != 'original'
    assign custom_aspect_ratio = true
  endif

  if image_crop == 'adapt_to_first_image'
    assign first_image_ratio = product.media.first.preview_image.aspect_ratio
    assign adapt_ratio = 1 | divided_by: first_image_ratio | times: 100
  endif

  assign change_variant_based_on_thumbnail = false
  for block in section.blocks
    case block.type
      when "options"
        if block.settings.thumbnail_changes_variant == true
          assign change_variant_based_on_thumbnail = true
        endif
    endcase
  endfor

  assign enable_video_loop = section.settings.enable_video_loop
  assign enable_autoplay = section.settings.enable_autoplay
  assign show_video_controls = section.settings.show_video_controls

  comment
    Product badges
  endcomment
  assign preorder_string = 'products.product.preorder' | t | downcase
  assign preorder_product = false

  for tag in product.tags
    assign lowercase_tag = tag | downcase
    if lowercase_tag contains preorder_string
      assign preorder_product = true
    endif
    assign lowercase_tag = tag | downcase
    if lowercase_tag contains preorder_string
      assign preorder_product = true
    endif
    if preorder_product == false and tag contains '_badge:'
      assign custom_badge = tag | remove: '_badge:'
    endif
  endfor
%}

<safe-load-scripts class="hidden">
  <script src="{{ 'component-deferred-media.js' | asset_url }}" defer="defer" type="module" data-flow-load-key="deferred-media"></script>
</safe-load-scripts>

<safe-load-scripts class="hidden">
  <script src="{{ 'component-product-media.js' | asset_url }}" defer="defer" type="module" data-flow-load-key="product-media"></script>
</safe-load-scripts>

{% if settings.show_badges %}
  {% capture product_badge %}
    {% if product != blank %}
      {% if product.available %}
        {% comment %} Always show sale/discount badge if applicable {% endcomment %}
        {% render 'badge' with badge: 'sale', badge_product: product, use_variant: true %}
        
        {% comment %} Show preorder badge {% endcomment %}
        {% if preorder_product %}
          {% render 'badge' with badge: 'preorder', preorder_badge: preorder_string %}
        {% endif %}
        
        {% comment %} Show up to 2 custom badges from tags {% endcomment %}
        {% assign custom_badge_count = 0 %}
        {% for tag in product.tags %}
          {% if tag contains '_badge:' and custom_badge_count < 2 %}
            {% assign custom_badge_text = tag | remove: '_badge:' %}
            {% render 'badge' with badge: 'custom', custom_badge: custom_badge_text %}
            {% assign custom_badge_count = custom_badge_count | plus: 1 %}
          {% endif %}
        {% endfor %}
      {% else %}
        {% render 'badge' with badge: 'sold-out', badge_product: product %}
      {% endif %}
    {% else %}
      {% render 'badge' with badge: 'sold-out' %}
    {% endif %}
  {% endcapture %}
{% endif %}

<product-media 
  id="{{ id }}"
  data-device="{{ device }}"
  data-image-size="{{ section.settings.image_size }}"
  data-image-cropped="{{ custom_aspect_ratio }}"
  data-section-id="{{ section_id }}"
  data-peep-enabled="{% if device == 'mobile' and enable_peep == true %}true{% else %}false{% endif %}"
  data-pagination-enabled="{% if has_pagination %}true{% else %}false{% endif %}"
  data-thumbnail-position="{{ thumbnail_position }}"
  data-media-type="{{ type }}"
  data-media-count="{% if onboarding and product.media.size == 0 %}3{% else %}{{ product.media.size }}{% endif %}"
  data-autoplay-enabled="{% if enable_autoplay %}true{% else %}false{% endif %}"
  data-selected-variant="{{ product.selected_or_first_available_variant | json | escape }}"
  class="product-media-slider product-media-slider-{{ device }} thumbnails-{{ thumbnail_position }} media-type-{{ type }}{% if product.media.size == 1 or product.media.size == 0 and onboarding == false %} single-media{% endif %}"
  {% if change_variant_based_on_thumbnail %}
    data-change-variant-based-on-thumbnail="true"
  {% endif %}
  data-quick-view="{% if is_quick_view %}true{% else %}false{% endif %}"
>
  {% if product.media.size > 0 or onboarding %}
    {% comment %} ==== MAIN SLIDER ==== {% endcomment %}
    <div data-media-main data-slider-main class="{% if type == 'thumbnails' %}thumbnail-media--main-media{% else %}product-media-slider-main{% endif %} swiper{% if custom_aspect_ratio %} custom-aspect-ratio{% endif %}{% if product.media.size == 1 %} media--single{% endif %}{% unless enable_peep %} block-radius-clip{% endunless %}">
      {% comment %} ==== BADGES ==== {% endcomment %}
      <div data-product-badge{% if settings.border_radius == 'round' %} class="product-media-badge--extra-spacing"{% endif %}>
        {{ product_badge }}
      </div>

      {% comment %} ==== SLIDES ==== {% endcomment %}
      <div class="swiper-wrapper">
        {% if product.media.size > 0 %}
          {% comment %} Check if selected variant has any metafield images {% endcomment %}
          {% assign selected_variant = product.selected_or_first_available_variant %}
          {% assign has_variant_images = false %}
          {% if selected_variant.metafields.custom.variant_images %}
            {% assign has_variant_images = true %}
          {% endif %}

          {% comment %} Show product media only if NO variant metafields exist {% endcomment %}
          {% unless has_variant_images %}
            {% for media in product.media %}
              {% comment %}
                If this media is assigned to any variant that is available, keep showing the thumbnail.
                EVERY variant with this media needs to be unavailable for it to be hidden.
              {% endcomment %}
              {% liquid 
                assign hideThumb = false
                assign mediaHasVariant = false

                if hide_out_of_stock_variants
                  assign hideThumb = true
                  for option in product.options_with_values
                    for option_value in option.values
                      if option_value.variant.featured_media.id == media.id
                        assign mediaHasVariant = true

                        if option_value.variant.available
                          assign hideThumb = false
                        endif
                      endif
                    endfor
                  endfor
                endif
              %}

              {% unless hideThumb and mediaHasVariant %}
                <div 
                  class="swiper-slide{% if product.media.size == 1 %} animated fadeIn{% endif %}{% if enable_peep %} block-radius-clip{% endif %}"
                  {%- if product.media.size > 1 -%}
                    style="visibility:hidden;"
                  {%- endif -%}
                  data-media-type="{{ media.media_type }}"
                  data-media-id="{{ media.id }}"
                  {%- assign found = false -%}
                  {%- for option in product.options_with_values -%}
                    {%- for value in option.values -%}
                      {%- liquid 
                        assign is_combined_listing = false
                        if value.product_url != blank
                          assign is_combined_listing = true
                          assign item_url = value.product_url | append: '?variant=' | append: value.variant.id
                          assign product_url = value.product_url
                        else
                          assign item_url = value.variant.url
                          assign product_url = value.variant.product.url
                        endif
                      -%}
                      {%- if found == false and value.variant.featured_media.id == media.id -%}
                        data-variant="{{ value.variant | json | escape }}"
                        data-is-combined-listing="{{ is_combined_listing }}"
                        data-product-fetch-url="{{ item_url }}"
                        data-product-url="{{ product_url }}"
                        {%- assign found = true -%}
                      {%- endif -%}
                    {%- endfor -%}
                  {%- endfor -%}
                >
                  {% if media.media_type == 'image' %}
                    <a 
                      data-main-media-link
                      href="{{ media.preview_image | image_url: width: 1445 }}"
                      data-pswp-width="{{ media.width }}"
                      data-pswp-height="{{ media.height }}"
                      target="_blank"
                      {% if adapt_ratio %}style="padding-bottom: {{ adapt_ratio }}%;"{% endif %}
                      {% if settings.animations_enabled %}class="kb-enabled"{% endif %}
                    >

                    <img
                      class="theme-img media-ratio--{{ image_crop }}"
                      src="{{ media.preview_image | image_url: width: 1445 }}"
                      alt="{% if media.alt != product.title %}{{ media.alt }}{% endif %}"
                      width="{{ media.width }}"
                      height="{{ media.height }}"
                      sizes="(min-width: 1200px) calc((1200px - 10rem) / 2), (min-width: 750px) calc((100vw - 11.5rem) / 2), calc(100vw - 4rem)"
                      loading="eager"
                    />
                  
                    </a>
                  {% else %}
                    {% render 'deferred-media' with delayed_media: media, section_id: section_id, enable_video_loop: enable_video_loop, enable_autoplay: enable_autoplay, media_wrapper_classes: 'product-single__media__wrapper', aspect_ratio: image_crop, media_product: product, media_type: 'slider', show_controls: show_video_controls %}
                  {% endif %}

                  
                  {%- if media.media_type == 'model' -%}
                    <div class="button-wrap view-in-space--wrapper">
                      <button
                        type="button"
                        aria-label="{{ 'products.product.view_in_space_label' | t }}"
                        class="btn product-medias__view-in-space"
                        data-shopify-xr
                        data-shopify-model3d-id="{{ media.id }}"
                        data-shopify-title="{{ product.title | escape }}"
                        data-shopify-xr-hidden
                      >
                        {{ 'products.product.view_in_space' | t }}
                      </button>
                    </div>
                  {%- endif -%}

                  {%- if first_3d_model -%}
                    <script type="application/json" id="ProductJSON-{{ product.id }}">
                      {{ product.media | where: 'media_type', 'model' | json }}
                    </script>
                  {%- endif -%}

                  <script type="application/json" id="ProductJSON-{{ product.id }}">
                    {{ product.media | where: 'media_type', 'model' | json }}
                  </script>
                </div>
              {% endunless %}
            {% endfor %}
          {% endunless %}

          {% comment %} Show variant metafield images in main slider if they exist {% endcomment %}
          {% if has_variant_images %}
            {% comment %} First show variant's featured image if it exists {% endcomment %}
            {% if selected_variant.featured_media %}
              <div 
                class="swiper-slide{% if enable_peep %} block-radius-clip{% endif %}"
                {%- if product.media.size > 1 -%}
                  style="visibility:hidden;"
                {%- endif -%}
                data-media-type="{{ selected_variant.featured_media.media_type }}"
                data-media-id="variant-featured-{{ selected_variant.id }}"
                data-variant-id="{{ selected_variant.id }}"
                data-variant-image="featured"
              >
                {% if selected_variant.featured_media.media_type == 'image' %}
                  <a 
                    data-main-media-link
                    href="{{ selected_variant.featured_media.preview_image | image_url: width: 1445 }}"
                    data-pswp-width="{{ selected_variant.featured_media.width }}"
                    data-pswp-height="{{ selected_variant.featured_media.height }}"
                    target="_blank"
                    {% if adapt_ratio %}style="padding-bottom: {{ adapt_ratio }}%;"{% endif %}
                    {% if settings.animations_enabled %}class="kb-enabled"{% endif %}
                  >

                  <img
                    class="theme-img media-ratio--{{ image_crop }}"
                    src="{{ selected_variant.featured_media.preview_image | image_url: width: 1445 }}"
                    alt="{% if selected_variant.featured_media.alt != blank %}{{ selected_variant.featured_media.alt }}{% else %}{{ product.title }} - {{ selected_variant.title }}{% endif %}"
                    width="{{ selected_variant.featured_media.width }}"
                    height="{{ selected_variant.featured_media.height }}"
                    sizes="(min-width: 1200px) calc((1200px - 10rem) / 2), (min-width: 750px) calc((100vw - 11.5rem) / 2), calc(100vw - 4rem)"
                    loading="eager"
                  />
                
                  </a>
                {% else %}
                  {% render 'deferred-media' with delayed_media: selected_variant.featured_media, section_id: section_id, enable_video_loop: enable_video_loop, enable_autoplay: enable_autoplay, media_wrapper_classes: 'product-single__media__wrapper', aspect_ratio: image_crop, media_product: product, media_type: 'slider', show_controls: show_video_controls %}
                {% endif %}
              </div>
            {% endif %}

            {% comment %} Then show variant_image_2 through variant_image_6 {% endcomment %}
                  {% assign variant_image_num = forloop.index | plus: 1 %}
            {% for variant_image in selected_variant.metafields.custom.variant_images.value %}
              {% assign variant_image_num = forloop.index | plus: 1 %}
              
              {% if variant_image != blank %}
                <div 
                  class="swiper-slide{% if enable_peep %} block-radius-clip{% endif %}"
                  {%- if product.media.size > 1 -%}
                    style="visibility:hidden;"
                  {%- endif -%}
                  data-media-type="image"
                  data-media-id="variant-{{ selected_variant.id }}-{{ variant_image_num }}"
                  data-variant-id="{{ selected_variant.id }}"
                  data-variant-image="{{ variant_image_num }}"
                >
                  <a 
                    data-main-media-link
                    href="{{ variant_image | image_url: width: 1445 }}"
                    data-pswp-width="{{ variant_image.width | default: 1445 }}"
                    data-pswp-height="{{ variant_image.height | default: 1445 }}"
                    target="_blank"
                    {% if adapt_ratio %}style="padding-bottom: {{ adapt_ratio }}%;"{% endif %}
                    {% if settings.animations_enabled %}class="kb-enabled"{% endif %}
                  >

                  <img
                    class="theme-img media-ratio--{{ image_crop }}"
                    src="{{ variant_image | image_url: width: 1445 }}"
                    alt="{% if variant_image.alt != blank %}{{ variant_image.alt }}{% else %}{{ product.title }} - {{ selected_variant.title }} - Image {{ variant_image_num }}{% endif %}"
                    width="{{ variant_image.width | default: 1445 }}"
                    height="{{ variant_image.height | default: 1445 }}"
                    sizes="(min-width: 1200px) calc((1200px - 10rem) / 2), (min-width: 750px) calc((100vw - 11.5rem) / 2), calc(100vw - 4rem)"
                    loading="eager"
                  />
                
                  </a>
                </div>
              {% endif %}
            {% endfor %}
          {% endif %}
        {% else %}
          {% comment %} Onboarding placeholder slides {% endcomment %}
          {% assign svg_classes = 'icon icon--placeholder block-radius media-ratio--' | append: image_crop %}
          {% for i in (1..3) %}
            <div class="swiper-slide" style="visibility:hidden;">
              {% assign svg_name = 'product-' | append: i %}
              {{ svg_name | placeholder_svg_tag: svg_classes }}
            </div>
          {% endfor %}
        {% endif %}
      </div>

      {% comment %} ==== PAGINATION ==== {% endcomment %}
      {% if has_pagination %}
        <div class="media-slider-navigation arrows input-radius-clip">
          <a href="#" class="flex-prev arrow-prev-{{ id }}-{{ section_id }} standalone-icon--wrapper">
            {% render 'theme-icon' with icon: 'chevron_left', iconWidth: 24, iconHeight: 24, iconColor: 'currentColor' %}
          </a>

          <div class="swiper-pagination-{{ id }}-{{ section_id }}"></div>

          <a href="#" class="flex-next arrow-next-{{ id }}-{{ section_id }} standalone-icon--wrapper">
            {% render 'theme-icon' with icon: 'chevron_right', iconWidth: 24, iconHeight: 24, iconColor: 'currentColor' %}
          </a>
        </div>
      {% endif %}

      {% if type == 'thumbnails' %}
        <a href="#" class="thumb-prev arrow-prev-{{ id }}-{{ section_id }}">
          {% render 'theme-icon' with icon: 'chevron_left', iconWidth: 24, iconHeight: 24, iconColor: 'currentColor' %}
        </a>

        <a href="#" class="thumb-next arrow-next-{{ id }}-{{ section_id }}">
          {% render 'theme-icon' with icon: 'chevron_right', iconWidth: 24, iconHeight: 24, iconColor: 'currentColor' %}
        </a>
      {% endif %}
    </div>

    {% comment %} ==== THUMBNAILS ==== {% endcomment %}
    {% if type == 'thumbnails' %}
      {% if product.media.size > 1 or onboarding %}
        <div 
                      data-updates-on-change
                      data-update-id="item-title" data-media-thumbnails class="thumbnail-media--thumbnails swiper">
          <div class="swiper-wrapper">
            {% if product.media.size > 0 %}
              {% comment %} Check if selected variant has any metafield images {% endcomment %}
              {% assign selected_variant = product.selected_or_first_available_variant %}
              {% assign has_variant_images = false %}
              {% if selected_variant.metafields.custom.variant_images %}
                {% assign has_variant_images = true %}
              {% endif %}

              {% comment %} Show product media only if NO variant metafields exist {% endcomment %}
              {% unless has_variant_images %}
                {% for media in product.media %}
                  {% comment %}
                    If this media is assigned to any variant that is available, keep showing the thumbnail.
                    EVERY variant with this media needs to be unavailable for it to be hidden.
                  {% endcomment %}

                  {% liquid 
                    assign hideThumb = false
                    assign mediaHasVariant = false

                    if hide_out_of_stock_variants
                      assign hideThumb = true
                      for option in product.options_with_values
                        for option_value in option.values
                          if option_value.variant.featured_media.id == media.id
                            assign mediaHasVariant = true

                            if option_value.variant.available
                              assign hideThumb = false
                            endif
                          endif
                        endfor
                      endfor
                    endif
                  %}

                  {% unless hideThumb and mediaHasVariant %}
                    <div class="swiper-slide"
                      {%- if product.media.size > 1 -%}
                        style="visibility:hidden;"
                      {%- endif -%}
                    >
                      {% if media.media_type == 'model' %}
                        <div class="product-medias__emblem">
                          {% render 'theme-icon' with icon: 'cube', iconSize: 20 %}
                        </div>
                      {% elsif media.media_type == 'video' or media.media_type == 'external_video' %}
                        <div class="product-medias__emblem">
                          {% render 'theme-icon' with icon: 'play', iconSize: 20 %}
                        </div>
                      {% endif %}

                      {% capture props %}
                        data-image-id="{{ media.id }}"
                        data-max-width="{{ media.preview_image.width }}"
                      {% endcapture %}

                      {% capture styles %}max-width: {{ media.preview_image.width }}px;{% endcapture %}
                      {% capture class %}
                        product-medias__thumbnail__image product-medias__thumbnail--{{ media.media_type }} media-ratio--{{ image_crop }} thumbnail-radius
                      {% endcapture %}

                      {% capture thumbalt %}
                        {% if media.alt == product.title %}
                          {{ null }}
                        {% elsif media.media_type == 'video' or media.media_type == 'external_video' %}
                          {{ 'products.product.video_thumbnail_alt' | t: imageAlt: media.alt | escape }}
                        {% elsif media.media_type == 'model' %}
                          {{ 'products.product.model_thumbnail_alt' | t: imageAlt: media.alt | escape }}
                        {% else %}
                          {{ media.alt }}
                        {% endif %}
                      {% endcapture %}

                      {% render 'responsive-image' with media.preview_image, wrapper_class: 'thumbnail-radius', class: class, alt: thumbalt | escape, default_size: '300x', props: props, blur: false, styles: styles, adaptive_ratio: adapt_ratio %}
                    </div>
                  {% endunless %}
                {% endfor %}
              {% endunless %}

              {% comment %} Show variant metafield images if they exist {% endcomment %}
              {% if has_variant_images %}
                {% comment %} First show variant's featured image if it exists {% endcomment %}
                {% if selected_variant.featured_media %}
                  <div class="swiper-slide variant-thumbnail"
                    {%- if product.media.size > 1 -%}
                      style="visibility:hidden;"
                    {%- endif -%}
                    data-variant-id="{{ selected_variant.id }}"
                    data-variant-image="featured"
                  >
                    {% if selected_variant.featured_media.media_type == 'model' %}
                      <div class="product-medias__emblem">
                        {% render 'theme-icon' with icon: 'cube', iconSize: 20 %}
                      </div>
                    {% elsif selected_variant.featured_media.media_type == 'video' or selected_variant.featured_media.media_type == 'external_video' %}
                      <div class="product-medias__emblem">
                        {% render 'theme-icon' with icon: 'play', iconSize: 20 %}
                      </div>
                    {% endif %}

                    {% capture props %}
                      data-image-id="variant-featured-{{ selected_variant.id }}"
                      data-max-width="{{ selected_variant.featured_media.preview_image.width | default: 300 }}"
                      data-variant-metafield="false"
                    {% endcapture %}

                    {% capture styles %}max-width: {{ selected_variant.featured_media.preview_image.width | default: 300 }}px;{% endcapture %}
                    {% capture class %}
                      product-medias__thumbnail__image product-medias__thumbnail--{{ selected_variant.featured_media.media_type }} media-ratio--{{ image_crop }} thumbnail-radius
                    {% endcapture %}

                    {% capture thumbalt %}
                      {% if selected_variant.featured_media.alt != blank %}
                        {{ selected_variant.featured_media.alt }}
                      {% else %}
                        {{ product.title }} - {{ selected_variant.title }}
                      {% endif %}
                    {% endcapture %}

                    {% render 'responsive-image' with selected_variant.featured_media.preview_image, wrapper_class: 'thumbnail-radius', class: class, alt: thumbalt | escape, default_size: '300x', props: props, blur: false, styles: styles, adaptive_ratio: adapt_ratio %}
                  </div>
                {% endif %}

                {% comment %} Then show variant_image_2 through variant_image_6 {% endcomment %}
                {% for variant_image in selected_variant.metafields.custom.variant_images.value %}
                  {% assign variant_image_num = forloop.index | plus: 1 %}
                  
                  {% if variant_image != blank %}
                    <div class="swiper-slide variant-thumbnail"
                      {%- if product.media.size > 1 -%}
                        style="visibility:hidden;"
                      {%- endif -%}
                      data-variant-id="{{ selected_variant.id }}"
                      data-variant-image="{{ variant_image_num }}"
                    >
                      {% capture props %}
                        data-image-id="variant-{{ selected_variant.id }}-{{ variant_image_num }}"
                        data-max-width="{{ variant_image.width | default: 300 }}"
                        data-variant-metafield="true"
                      {% endcapture %}

                      {% capture styles %}max-width: {{ variant_image.width | default: 300 }}px;{% endcapture %}
                      {% capture class %}
                        product-medias__thumbnail__image product-medias__thumbnail--variant-metafield media-ratio--{{ image_crop }} thumbnail-radius
                      {% endcapture %}

                      {% capture thumbalt %}
                        {% if variant_image.alt != blank %}
                          {{ variant_image.alt }}
                        {% else %}
                          {{ product.title }} - {{ selected_variant.title }} - Image {{ variant_image_num }}
                        {% endif %}
                      {% endcapture %}

                      {% comment %} Use direct image tag instead of responsive-image to avoid srcset issues {% endcomment %}
                      <div class="thumbnail-radius {{ class }}" {{ props }} style="{{ styles }}">
                        <img 
                          src="{{ variant_image | image_url: width: 300 }}"
                          alt="{{ thumbalt | escape }}"
                          width="{{ variant_image.width | default: 300 }}"
                          height="{{ variant_image.height | default: 300 }}"
                          loading="lazy"
                          class="theme-img"
                        />
                      </div>
                    </div>
                  {% endif %}
                {% endfor %}
              {% endif %}
            {% else %}
              {% comment %} Onboarding placeholder thumbnails {% endcomment %}
              {% assign svg_classes = 'icon icon--placeholder thumbnail-radius product-medias__thumbnail__image product-medias__thumbnail--image media-ratio--' | append: image_crop %}
              {% for i in (1..3) %}
                <div class="swiper-slide" style="visibility:hidden;">
                  {% assign svg_name = 'product-' | append: i %}
                  {{ svg_name | placeholder_svg_tag: svg_classes }}
                </div>
              {% endfor %}
            {% endif %}
          </div>
        </div>
      {% endif %}
    {% endif %}
  {% else %}
    {% comment %} ==== BADGES ==== {% endcomment %}
    <div data-product-badge>
      {{ product_badge }}
    </div>
    
    {% comment %} ==== PLACEHOLDER ==== {% endcomment %}
    {% assign svg_classes = 'icon icon--placeholder block-radius media-ratio--' | append: image_crop %}
    {{ 'product-1' | placeholder_svg_tag: svg_classes }}
  {% endif %}
</product-media>

